<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/blog/_next/static/css/d34310680f0ae524e008.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/d34310680f0ae524e008.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/blog/_next/static/chunks/webpack-3297a19f96a66183618c.js" defer=""></script><script src="/blog/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/blog/_next/static/chunks/main-7965b115b2b3050da998.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-af9d5cea1e8d1d045b76.js" defer=""></script><script src="/blog/_next/static/chunks/pages/posts/%5Bslug%5D-d2871fd38e828eabd2bb.js" defer=""></script><script src="/blog/_next/static/jhtB4XnGqiC7RRkEOziLr/_buildManifest.js" defer=""></script><script src="/blog/_next/static/jhtB4XnGqiC7RRkEOziLr/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="h-full flex flex-col"><div class="sticky top-0 shadow-md bg-gray-800 text-white"><div class="container mx-auto md:px-52 px-10"><header><div class="flex py-1.5 items-center"><a class="mr-auto hover:bg-gray-700 hover:no-underline p-3 hover:text-white py-1.5 rounded transition duration-200" href="/blog"><h1 class="text-2xl mb-0">Douglas Greyling</h1></a><a class="button" href="/blog/posts">All Posts</a></div></header></div></div><main class="bg-gray-100 pt-10 flex-auto"><div class="container mx-auto md:px-52 px-10 overflow-hidden"><div><h1>SQL Self Join</h1><h2 class="text-gray-400 font-extralight mb-5 text-lg">May 4 2020</h2><div><p>I recently learnt that SQL has the ability to join a table to itself, this is called a self-join. This is possible when you have a table which has a column referencing the primary key.</p>
<p>Let’s say for example we have an employees table which looks something like this:</p>
<table>
<thead>
<tr>
<th>employee_id</th>
<th>first_name</th>
<th>last_name</th>
<th>manager_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Abraham</td>
<td>Lincoln</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>Benjamin</td>
<td>Franklin</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>Charlie</td>
<td>Brown</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>Douglas</td>
<td>Greyling</td>
<td>2</td>
</tr>
</tbody></table>
<p>So, for this example, <code>employee_id</code> is our primary key for all of our employees. The employees table has another column, <code>manager_id</code>, which tracks whether, or not, this employee has a manager. No manager id could mean that this employee is the head honcho in charge, or that they are a manager who reports to another manager. Makes sense?</p>
<p>Either way, we can do a self-join on this table to find all employees who have managers.</p>
<pre><code class="language-sql">SELECT e.first_name, e.last_name, m.first_name AS manager
FROM employees e
JOIN employees m
ON e.manager_id = m.employee_id;
</code></pre>
<p>Or to be more succinct:</p>
<pre><code class="language-sql">SELECT e.first_name, e.last_name, m.first_name AS manager
FROM employees e, employees m
WHERE e.manager_id = m.employee_id;
</code></pre>
<p>Our result should look something like this:</p>
<table>
<thead>
<tr>
<th>first_name</th>
<th>last_name</th>
<th>manager</th>
</tr>
</thead>
<tbody><tr>
<td>Benjamin</td>
<td>Franklin</td>
<td>Abraham</td>
</tr>
<tr>
<td>Charlie</td>
<td>Brown</td>
<td>Abraham</td>
</tr>
<tr>
<td>Douglas</td>
<td>Greyling</td>
<td>Benjamin</td>
</tr>
</tbody></table>
<p>And that’s it. I knew about the concept of joins, but I didn’t realise that one could do a self-join. I thought this was pretty awesome!</p>
</div></div><div class="flex justify-center pt-10 pb-20"><a class="button" href="/blog/posts"><h4>Read more posts</h4></a></div></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"id":1,"title":"SQL Self Join","date":"May 4 2020"},"slug":"sql-self-join","content":"\u003cp\u003eI recently learnt that SQL has the ability to join a table to itself, this is called a self-join. This is possible when you have a table which has a column referencing the primary key.\u003c/p\u003e\n\u003cp\u003eLet’s say for example we have an employees table which looks something like this:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eemployee_id\u003c/th\u003e\n\u003cth\u003efirst_name\u003c/th\u003e\n\u003cth\u003elast_name\u003c/th\u003e\n\u003cth\u003emanager_id\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003eAbraham\u003c/td\u003e\n\u003ctd\u003eLincoln\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003eBenjamin\u003c/td\u003e\n\u003ctd\u003eFranklin\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003eCharlie\u003c/td\u003e\n\u003ctd\u003eBrown\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003eDouglas\u003c/td\u003e\n\u003ctd\u003eGreyling\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eSo, for this example, \u003ccode\u003eemployee_id\u003c/code\u003e is our primary key for all of our employees. The employees table has another column, \u003ccode\u003emanager_id\u003c/code\u003e, which tracks whether, or not, this employee has a manager. No manager id could mean that this employee is the head honcho in charge, or that they are a manager who reports to another manager. Makes sense?\u003c/p\u003e\n\u003cp\u003eEither way, we can do a self-join on this table to find all employees who have managers.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSELECT e.first_name, e.last_name, m.first_name AS manager\nFROM employees e\nJOIN employees m\nON e.manager_id = m.employee_id;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOr to be more succinct:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSELECT e.first_name, e.last_name, m.first_name AS manager\nFROM employees e, employees m\nWHERE e.manager_id = m.employee_id;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOur result should look something like this:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003efirst_name\u003c/th\u003e\n\u003cth\u003elast_name\u003c/th\u003e\n\u003cth\u003emanager\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003eBenjamin\u003c/td\u003e\n\u003ctd\u003eFranklin\u003c/td\u003e\n\u003ctd\u003eAbraham\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eCharlie\u003c/td\u003e\n\u003ctd\u003eBrown\u003c/td\u003e\n\u003ctd\u003eAbraham\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eDouglas\u003c/td\u003e\n\u003ctd\u003eGreyling\u003c/td\u003e\n\u003ctd\u003eBenjamin\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eAnd that’s it. I knew about the concept of joins, but I didn’t realise that one could do a self-join. I thought this was pretty awesome!\u003c/p\u003e\n"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"sql-self-join"},"buildId":"jhtB4XnGqiC7RRkEOziLr","assetPrefix":"/blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>