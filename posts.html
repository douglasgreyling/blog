<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/blog/_next/static/css/d34310680f0ae524e008.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/d34310680f0ae524e008.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/blog/_next/static/chunks/webpack-3297a19f96a66183618c.js" defer=""></script><script src="/blog/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/blog/_next/static/chunks/main-7965b115b2b3050da998.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-8cc78227ff078f8b1b93.js" defer=""></script><script src="/blog/_next/static/chunks/pages/posts-78081b55fff09fcfb710.js" defer=""></script><script src="/blog/_next/static/BrnbQXyTJJ40OBczySqjf/_buildManifest.js" defer=""></script><script src="/blog/_next/static/BrnbQXyTJJ40OBczySqjf/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="h-full flex flex-col"><div class="sticky top-0 shadow-md bg-gray-800 text-white"><div class="container mx-auto md:px-52 px-10"><header><div class="flex py-1.5 items-center"><a class="mr-auto hover:bg-gray-700 hover:no-underline p-3 hover:text-white py-1.5 rounded transition duration-200" href="blog/"><h1 class="text-2xl mb-0">Douglas Greyling</h1></a><a class="button" href="blog/posts">All Posts</a></div></header></div></div><main class="bg-gray-100 pt-10 flex-auto"><div class="container mx-auto md:px-52 px-10 overflow-hidden"><div><h3>All Posts</h3><ul><li><a href="blog/posts/communication-between-angular-components">Communication Between Angular Components</a></li><li><a href="blog/posts/how-angular-has-changed-my-react">How Angular Has Changed My React</a></li><li><a href="blog/posts/sql-transactions">SQL Transactions</a></li><li><a href="blog/posts/sql-events">SQL Events</a></li><li><a href="blog/posts/sql-triggers">SQL Triggers</a></li><li><a href="blog/posts/sql-functions">SQL Functions</a></li><li><a href="blog/posts/sql-stored-procedures">SQL Stored Procedures</a></li><li><a href="blog/posts/deriving-tables-from-sub-queries">Deriving Tables From Sub-Queries</a></li><li><a href="blog/posts/sql-views">SQL Views</a></li><li><a href="blog/posts/sql-cross-join">SQL Cross Join</a></li><li><a href="blog/posts/sql-self-join">SQL Self Join</a></li></ul></div></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"slug":"communication-between-angular-components","frontmatter":{"id":11,"title":"Communication Between Angular Components","date":"June 29 2020"},"content":"\u003cp\u003eI thought I could go through how to hook Angular components to each other so they can listen to each other listen for specific events. Angular components are able to receive a set of inputs, by decorating properties of the class with the \u003ccode\u003e@Input\u003c/code\u003e decorator, likewise we can set the outputs of a particular component using the \u003ccode\u003e@Output\u003c/code\u003e decorator.\u003c/p\u003e\n\u003cp\u003eLet’s imagine we’re making a simple party app where we have two components in our app. The one has a button, which when clicked emits a party event. When this event is raised, our second component needs to flash the appropriate message, so we all know what to do.\u003c/p\u003e\n\u003cp\u003eThe one component (let’s call it our \u003ccode\u003ePartyButtonComponent\u003c/code\u003e) is the component which displays the appropriate button. It needs to raise an event, when the button is clicked.\nIts controller will look like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eimport { Component, Output, EventEmitter } from \u0026#39;@angular/core\u0026#39;;\n\n@Component({\n  selector: \u0026#39;party-button\u0026#39;,\n  templateUrl: \u0026#39;./party-button.component.html\u0026#39;,\n  styleUrls: [\u0026#39;./party-button.component.css\u0026#39;]\n})\nexport class PartyButtonComponent  {\n  @Output() onParty: EventEmitter\u0026lt;null\u0026gt; = new EventEmitter\u0026lt;null\u0026gt;();\n\n  party() {\n    this.onParty.emit();\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd its template will look something like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;button class=\u0026quot;btn btn-success\u0026quot; type=\u0026quot;button\u0026quot; (click)=\u0026quot;party()\u0026quot;\u0026gt;Party!\u0026lt;/button\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere we’ve created our party button component. We’ve created an \u003ccode\u003eonParty\u003c/code\u003e output, which uses an Angular Event Emitter so that Angular can pick up on our events and initiate change detection.\u003c/p\u003e\n\u003cp\u003eThe button in our template will emit the \u003ccode\u003eonParty\u003c/code\u003e event, when the \u003ccode\u003eparty\u003c/code\u003e method is called by clicking the button.\u003c/p\u003e\n\u003cp\u003eNow, in order for our second component (which we’ll call the \u003ccode\u003ePartyTextComponent\u003c/code\u003e) to detect this event, it needs to listen to the \u003ccode\u003ePartyButtonComponent\u003c/code\u003e’s \u003ccode\u003eonParty\u003c/code\u003e event. We can do this like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;party-button (onParty)=\u0026quot;text.showPartyText()\u0026quot;\u0026gt;\u0026lt;/party-button\u0026gt;\n\u0026lt;party-text #text\u0026gt;\u0026lt;/party-text\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere we’ve defined our \u003ccode\u003ePartyButtonComponent\u003c/code\u003e and our \u003ccode\u003ePartyTextComponent\u003c/code\u003e. We’ve then defined a template variable called \u003ccode\u003etext\u003c/code\u003e, this creates a reference to \u003ccode\u003ePartyTextComponent\u003c/code\u003e which we can then use to call its \u003ccode\u003eshowPartyText()\u003c/code\u003e method when the \u003ccode\u003eonParty()\u003c/code\u003e event is emitted from our \u003ccode\u003ePartyButtonComponent\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eimport { Component } from \u0026#39;@angular/core\u0026#39;;\n\n@Component({\n  selector: \u0026#39;party-text\u0026#39;,\n  templateUrl: \u0026#39;./party-text.component.html\u0026#39;,\n  styleUrls: [\u0026#39;./party-text.component.css\u0026#39;]\n})\nexport class PartyTextComponent  {\n  private showText: Boolean = false;\n\n  showPartyText () {\n    this.showText = !this.showText;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere our \u003ccode\u003ePartyTextComponent\u003c/code\u003e is just keeping track of some state which will control whether, or not, the party text should be displayed. I’ll omit the template for this component since a simple directive is all you need to get this working.\u003c/p\u003e\n\u003cp\u003eBut that’s essentially it. This is a great way to allow components to listen to each other. The downside to this approach is that this method only allows us to have components communicate with each other in the template using template variables.\u003c/p\u003e\n\u003cp\u003eThere is a way to bring this code into the controllers of our components, but I’ll leave that for another blog.\u003c/p\u003e\n"},{"slug":"how-angular-has-changed-my-react","frontmatter":{"id":10,"title":"How Angular Has Changed My React","date":"June 12 2020"},"content":"\u003cp\u003eI’ve recently been learning how to develop front end applications using Angular through some online courses. Angular isn’t the first front end framework I’ve dealt with before. I’ve spent a significant amount of time working with React, although I don’t consider myself a React expert… yet.\u003c/p\u003e\n\u003cp\u003eWhilst I haven’t finished the current Angular course (and book) just yet, I can certainly say that I’ve learnt some valuable lessons from it all. Off the bat, I find that Angular has a steeper learning curve and I feel like that’s due to Angular having a more opinionated view on building components.\u003c/p\u003e\n\u003cp\u003eReact seems a little simpler since it feels like you’re dealing more with plain old Javascript (or Typescript). I found props and state a little easier to grasp than understanding things like Angular’s annotations and dependency injection.\u003c/p\u003e\n\u003cp\u003eThat’s not to say that Angular isn’t a great tool to use. If I had to share one thing which learning Angular has taught me, then it would be separation of concerns.\u003c/p\u003e\n\u003ch2 id=\"what-angular-has-taught-me\"\u003eWhat Angular has taught me\u003c/h2\u003e\n\u003cp\u003eWhat I’m about to share is purely based, on my experience and how I came about learning React and Angular. So, this isn’t some attempt to be a fan boy of one, or the other.\u003c/p\u003e\n\u003cp\u003eIn my experience so far, it appears that Angular does a better job at splitting things out across different files to make things simpler. For example, upon generating a component using \u003ccode\u003eng g c foo\u003c/code\u003e you get the following files:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efoo.component.css\nfoo.component.html\nfoo.component.ts\nfoo.component.spec.ts\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOut the box things are split up and things are kept separate. Our \u003ccode\u003efoo.component.ts\u003c/code\u003e file acts as a type of controller for the component and this differs from React where controller logic could be defined in one class with our markup. With Angular we have an HTML file to build the markup, and a separate CSS file to define some styles which will only apply to this component using (or emulating) the Shadow DOM.\u003c/p\u003e\n\u003ch2 id=\"style-me-like-one-of-your-french-girls\"\u003eStyle me like one of your French girls\u003c/h2\u003e\n\u003cp\u003eI recently had to fix an annoying issue where we had CSS styling markup which was completely unrelated. The issue occurred because a new bit of code had been shipped into master with some new styling. A new CSS class was defined with the same name as a pre-existing CSS class. Our styles were stuck in a fight to the death to determine who was king.\u003c/p\u003e\n\u003cp\u003eThe Shadow DOM is like a bit of CSS that is scoped to a specific element. You can have the same class names elsewhere in your app, but your Shadow DOM CSS won’t stick its nose in another component’s business. It wasn’t until I played with Angular that I learnt about this and I found this amazing! It’s this experience which lead me to learn about CSS modules. Something React can use to achieve the exact same thing.\u003c/p\u003e\n\u003ch2 id=\"at-your-service\"\u003eAt your service\u003c/h2\u003e\n\u003cp\u003eAnother thing Angular casts some great emphasis on is the concept of services. I can’t say that I know all the use cases where this might be useful, but a service is a class containing code which a component might use to query information (when its inserted into the DOM, or when some event is triggered).\u003c/p\u003e\n\u003cp\u003eQuerying data using HTTP is a prime example of something which could be extracted into a service. Our components shouldn’t need to know that we’re using HTTP, they should care about the DATA we get from HTTP.\u003c/p\u003e\n\u003cp\u003eOur component becomes a little simpler in that our inputs become easier to reason about. There are less things to reason about in the scope of the context or component. The other win (which is equally as large) is that your component is so much easier to test. You don’t have the headache of attempting to mock an HTTP service (at least in your component). Once again, your component becomes slightly more functional. Given X set of inputs, you can assert that it outputs Y in the expected format.\u003c/p\u003e\n\u003cp\u003eI’ve adopted this same approach when using React. Keep the HTTP stuff out of your component, and then rather give it a service as a prop where the component can query what it needs by calling a set methods. You’ll save yourself so much headache when you need to test things. It’s made testing components so much more enjoyable for me.\u003c/p\u003e\n\u003ch2 id=\"nothing-is-perfect\"\u003eNothing is perfect\u003c/h2\u003e\n\u003cp\u003eThe sad thing is that nothing is without fault. React or Angular in this instance.\u003c/p\u003e\n\u003cp\u003eI really wish that React had friendlier out-the-box support for things like conditionally adding classes to components, or conditionally showing components (something that Angular does well using class binding and directives).\u003c/p\u003e\n\u003cp\u003eOn the flip side of the coin, I appreciate that reading React code is a little simpler when you’re trying to see what’s a variable and what isn’t, and Angular isn’t quite as consistent in this regard. Angular has this weird quirk where a variable can appear in your HTML using curly braces (which is acceptable since its quite distinct from the rest of the markup), BUT a variable can also appear in your markup in the elements attributes as a string. Good luck debugging that as a noob.\u003c/p\u003e\n"},{"slug":"sql-transactions","frontmatter":{"id":9,"title":"SQL Transactions","date":"May 23 2020"},"content":"\u003cp\u003eA transaction is a group of SQL statements which represent a single unit of work. So, all of the statements inside the transaction must be completed successfully or else the transaction will fail.\u003c/p\u003e\n\u003cp\u003eA prime example could be a bank transaction. We’d have a problem if the withdrawal was successful, but the deposit never occurred. We’ve just lost money! Both events must be successful for the transaction to be complete.\u003c/p\u003e\n\u003cp\u003eThere are 4 key properties (ACID) of a good transaction:\u003c/p\u003e\n\u003cp\u003eAtomicity: All statements are performed as one operation. They must all be successful, or else the transaction has failed. Think all or nothing.\u003c/p\u003e\n\u003cp\u003eConsistency: The data must be consistent when a transaction starts and finishes. Like a bank transaction, we have not lost, or created, any extra money. The amount of funds is consistent.\u003c/p\u003e\n\u003cp\u003eIsolation: Transactions are isolated from each other if they try to update the same data. Transactions are queued up to run one by one.\u003c/p\u003e\n\u003cp\u003eDurability: The changes made by a transaction must persist if the transaction is successful. The changes must not be lost.\u003c/p\u003e\n\u003ch2 id=\"creating-a-transaction\"\u003eCreating a transaction:\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSTART TRANSACTION;\n\nINSERT INTO users (points)\nVALUES (100);\n\nCOMMIT;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis is fairly simple example, but the point is clear. We just have to wrap our SQL statements with \u003ccode\u003eSTART TRANSACTION\u003c/code\u003e and \u003ccode\u003eCOMMIT\u003c/code\u003e.\u003c/p\u003e\n\u003ch2 id=\"concurrency\"\u003eConcurrency:\u003c/h2\u003e\n\u003cp\u003eSo, when working with transactions, it’s possible that two, or more, transactions might attempt to retrieve, or change, fields on one row in a database table. Because of this possibility we have some potential concurrency headaches we have to take note of:\u003c/p\u003e\n\u003ch3 id=\"lost-updates\"\u003eLost updates:\u003c/h3\u003e\n\u003cp\u003eThis is when two transactions try to update the same row. The transaction that commits last will overwrite the changes the first transaction committed thus losing any updates which the first made.\u003c/p\u003e\n\u003cp\u003eImagine having a users table which tracks things like the users name and age.\nWe might have a user like this:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003ename\u003c/th\u003e\n\u003cth\u003eage\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003eAbe\u003c/td\u003e\n\u003ctd\u003e20\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eTransaction A updates the name like this:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003ename\u003c/th\u003e\n\u003cth\u003eage\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003eAbraham\u003c/td\u003e\n\u003ctd\u003e20\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eBut whilst this is happening, transaction B comes along and updates the age:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003ename\u003c/th\u003e\n\u003cth\u003eage\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003eAbe\u003c/td\u003e\n\u003ctd\u003e21\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eNot good! We’ve lost some data!\u003c/p\u003e\n\u003ch3 id=\"dirty-reads\"\u003eDirty reads:\u003c/h3\u003e\n\u003cp\u003eThis occurs when we have a transaction which reads data which hasn’t yet been committed.\u003c/p\u003e\n\u003cp\u003eFor example, transaction A is updating points belonging to a user. We then have transaction B do a calculation using points, and it reads the points which transaction A has set (but transaction A has not yet finished and committed its change). For some reason, transaction A fails and rolls back the value of the users’ points. The issue here is that transaction B might be using a value for points which is invalid, or which no longer exists (yet).\u003c/p\u003e\n\u003ch3 id=\"non-repeating-reads\"\u003eNon-repeating reads:\u003c/h3\u003e\n\u003cp\u003eThis is where data is read at two different times in one transaction, but the value has changed each time. For example, with the points. This might sound similar to dirty reads, but here’s the difference: We could be reading values which have been successfully committed.\u003c/p\u003e\n\u003cp\u003eSo essentially, we want the points to remain constant/consistent in the transaction.\u003c/p\u003e\n\u003cp\u003eImagine if transaction A queried points multiple times in a transaction, but transaction B came along and made a quick change to the points for the same user. Imagine trying to debug or recalculate that. Yikes!\u003c/p\u003e\n\u003ch3 id=\"phantom-reads\"\u003ePhantom reads:\u003c/h3\u003e\n\u003cp\u003eThis sort of issue occurs where we have transaction A which queries a table based on a certain criterion, let’s say where points are greater than ten, but then right afterwards transaction B updates a user to have enough points to match the criteria.\u003c/p\u003e\n\u003cp\u003eIn some cases, it might be critical to ensure that we don’t have anyone excluded from some queries we’ve made.\nIn this case, the solution would be to track and wait for transactions which to finish which could potentially cause phantom reads.\u003c/p\u003e\n\u003cp\u003eSo how do we solve these issues?\u003c/p\u003e\n\u003cp\u003eLuckily SQL has ways for transactions to overcome these issues using isolation levels. The following table shows the isolation level in the first column and what the isolation solves, marked with an ‘X’:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e\u003c/th\u003e\n\u003cth\u003eLost Updates\u003c/th\u003e\n\u003cth\u003eDirty Reads\u003c/th\u003e\n\u003cth\u003eNon-Repeating Reads\u003c/th\u003e\n\u003cth\u003ePhantom Reads\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003eREAD UNCOMMITTED\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eREAD COMMITTED\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003eX\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eREPEATABLE READ\u003c/td\u003e\n\u003ctd\u003eX\u003c/td\u003e\n\u003ctd\u003eX\u003c/td\u003e\n\u003ctd\u003eX\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eSERIALIZABLE\u003c/td\u003e\n\u003ctd\u003eX\u003c/td\u003e\n\u003ctd\u003eX\u003c/td\u003e\n\u003ctd\u003eX\u003c/td\u003e\n\u003ctd\u003eX\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eAs we move from \u003ccode\u003eREAD UNCOMMITTED\u003c/code\u003e to \u003ccode\u003eSERIALIZABLE\u003c/code\u003e we’re increasing our isolation level (and vice versa) which means that we are solving more of our concurrency issues.\u003c/p\u003e\n\u003cp\u003eNot all databases need the highest level of isolation, and one has to find the right balance of isolation vs performance. Increasing the level of isolation can slow down our transactions since we have to add locks and do things like wait for other transaction to finish etc.\u003c/p\u003e\n\u003cp\u003eBy default, MySQL’s transaction isolation level is set to \u003ccode\u003eREPEATABLE READ\u003c/code\u003e.\u003c/p\u003e\n\u003ch2 id=\"viewing-our-isolation-level\"\u003eViewing our isolation level:\u003c/h2\u003e\n\u003cp\u003eYou can see your isolation level like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSHOW VARIABLES LIKE ‘transaction_isolation’;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"setting-our-isolation-level\"\u003eSetting our isolation level:\u003c/h2\u003e\n\u003cp\u003eWe can set our isolation level to something different like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSET TRANSACTION ISOLATION LEVEL SERIALIZABLE;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHowever, this will only set the isolation level for the next transaction run. We can set it for all transaction in our session/connection like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd finally, we can also set it globally for all sessions:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSET GLOBAL TRANSACTION ISOLATION LEVEL SERIALIZABLE;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"deadlocks\"\u003eDeadlocks:\u003c/h2\u003e\n\u003cp\u003eSo, deadlocks really suck. I’ve had some bad experiences with them in the past, but they occur when different transactions cannot complete because each transaction has a lock on a row which the other transaction needs to access.\u003c/p\u003e\n\u003cp\u003eFor example:\u003c/p\u003e\n\u003cp\u003eTransaction A\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSTART TRANSACTION;\n\nUPDATE customers SET state = ‘VA’ where customer_id = 1;\nUPDATE orders SET status = 1 WHERE order_id = 1;\n\nCOMMIT;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTransaction B\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSTART TRANSACTION;\n\nUPDATE orders SET status = 1 WHERE order_id = 1;\nUPDATE customers SET state = ‘VA’ where customer_id = 1;\n\nCOMMIT;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBoth transactions could be run at roughly the same time, and a deadlock occurs because are waiting on each other. Transaction A needs the same orders row which transaction B is using, and transaction B is using the same customers row which transaction A needs.\u003c/p\u003e\n\u003cp\u003eIt can be a little difficult to deal with deadlocks, but we can keep an eye open for them when we write our queries. There are also strategies we can use to minimize this, like keeping our transactions as small as possible so that they complete as quick as possible (reducing the chance that the deadlock occurs), but that might be a topic for another day’s blog.\u003c/p\u003e\n"},{"slug":"sql-events","frontmatter":{"id":8,"title":"SQL Events","date":"May 21 2020"},"content":"\u003cp\u003eAn event in SQL is task, or block, of SQL code which gets executed based on a schedule. We can use it in situations where we’d like to automate the maintenance of db data, like deleting stale audit data (at least in this example). This post continues on from #7, so be sure to read that one if you haven’t.\u003c/p\u003e\n\u003cp\u003eTo start we need to turn the event scheduler on. This is the variable which tells our db to enable this kind of feature.\u003c/p\u003e\n\u003cp\u003eWe can try find it by doing something like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSHOW VARIABLES LIKE ‘event%’;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe should see the variable name, and its value which will either be \u003ccode\u003eON\u003c/code\u003e or \u003ccode\u003eOFF\u003c/code\u003e. We need it to be on and we can turn it on like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSET GLOBAL event_scheduler = ON;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"creating-an-event\"\u003eCreating an event\u003c/h2\u003e\n\u003cp\u003eLet’s create our first event:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDELIMITER $$\n\nCREATE EVENT yearly_delete_stale_audit_rows\nON SCHEDULE\n    EVERY 1 YEAR STARTS ‘2020-01-01’ ENDS ‘2022-01-01’\nDO BEGIN\n    DELETE FROM post_audits\n    WHERE date \u0026lt; NOW() – INTERVAL 1 YEAR;\nEND $$\n\nDELIMITER ;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd just like that we’ve created an event, given it a name which describes when its gonna kick in. Events can either be a once off type thing and we can do that by replacing \u003ccode\u003eON SCHEDULE\u003c/code\u003e with \u003ccode\u003eUSE AT ‘2020-01-01’\u003c/code\u003e which will only run this event on that date.\u003c/p\u003e\n\u003cp\u003eIn this case, we’d like to make it run on a schedule where it starts on ‘2020-01-01’ and it should end on ‘2022-01-01’, although the \u003ccode\u003eSTARTS\u003c/code\u003e and \u003ccode\u003eEND\u003c/code\u003e keywords are completely optional.\u003c/p\u003e\n\u003ch2 id=\"viewing-events\"\u003eViewing events\u003c/h2\u003e\n\u003cp\u003eWe can view our events like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSHOW EVENTS;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd don’t forget that we can also append \u003ccode\u003eLIKE\u003c/code\u003e to filter down results if we need to.\u003c/p\u003e\n\u003ch2 id=\"dropping-events\"\u003eDropping events\u003c/h2\u003e\n\u003cp\u003eLike most things we can delete them when we don’t want them anymore.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDROP EVENT yearly_delete_stale_audit_rows;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"altering-events\"\u003eAltering events\u003c/h2\u003e\n\u003cp\u003eBut what about when we want to change or disable or events?\u003c/p\u003e\n\u003cp\u003eTo change an event, use \u003ccode\u003eALTER EVENT\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDELIMITER $$\n\nALTER EVENT yearly_delete_stale_audit_rows\nON SCHEDULE\n    EVERY 1 YEAR STARTS ‘2019-01-01’ ENDS ‘2029-01-01’\nDO BEGIN\n    DELETE FROM post_audits\n    WHERE action_date \u0026lt; NOW() – INTERVAL 2 YEAR;\nEND $$\n\nDELIMITER ;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBut that might be heavy handed, when all we want to do is temporarily disable an event like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eALTER EVENT yearly_delete_stale_audit_rows DISABLE;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can later replace \u003ccode\u003eDISABLE\u003c/code\u003e with \u003ccode\u003eENABLE\u003c/code\u003e when we want to turn it back on!\u003c/p\u003e\n\u003cp\u003eAnd just like that we have an event which cleans up our stale audit data!\u003c/p\u003e\n"},{"slug":"sql-triggers","frontmatter":{"id":7,"title":"SQL Triggers","date":"May 20 2020"},"content":"\u003cp\u003eSQL triggers are essentially blocks of code which get automatically executed before (or after) insert, update, or delete statements. They’re super handy for things like ensuring data consistency, but in today’s example we’re gonna show how triggers can be a useful auditing tool.\u003c/p\u003e\n\u003cp\u003eLet’s say we have an app where users can create blogs posts. Users have the ability to create, edit and delete posts, but sometimes some users’ posts contain random changes which they swear they never added. We decide to create audit logs to track some of the changes made to the posts, like updating a blog post for example.\u003c/p\u003e\n\u003cp\u003eTo start things, lets imagine we have an audits table with the following info\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003epost_audits\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003euser_id\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003epost_id\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003edate\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eWe’ll also imagine that our blog post table stores the user who last updated the post.\u003c/p\u003e\n\u003ch2 id=\"creating-a-sql-trigger\"\u003eCreating a SQL trigger\u003c/h2\u003e\n\u003cp\u003eTo begin, we create a SQL trigger like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDELIMITER $$\n\nCREATE TRIGGER posts_after_update\n  AFTER UPDATE ON posts\n  FOR EACH ROW\nBEGIN\n  INSERT INTO post_audits\n  VALUES(\n    NEW.client_id,\n    NEW.post_id,\n    NEW.last_modified_user_id,\n    NOW()\n  );\nEND$$\n\nDELIMITER ;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI’m going to skip over some of the code that’s common with creating a stored procedure. If something is missing then be sure to check out post #5.\u003c/p\u003e\n\u003cp\u003eIn this case we’ve created a trigger with a descriptive name which helps us know when this trigger is fired.\u003c/p\u003e\n\u003cp\u003eWe can create triggers whenever data inside a table is inserted, deleted or updated. We can select whether we’d like this trigger to execute before or after the event has occurred. In this case our trigger fires after an update on the posts table, but we could change it to fire before by replacing \u003ccode\u003eAFTER\u003c/code\u003e with \u003ccode\u003eBEFORE\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eWe then state that for every row changed, create a row in the \u003ccode\u003epost_audits\u003c/code\u003e table.\u003c/p\u003e\n\u003cp\u003eThe body of our trigger inserts some of the post data into our \u003ccode\u003epost_audits\u003c/code\u003e table. In this instance, we’re interested in the updated values of the record being updated, so we refer to it using \u003ccode\u003eNEW\u003c/code\u003e followed by a \u003ccode\u003e.\u003c/code\u003e and the name of the field we’d like to get.\u003c/p\u003e\n\u003cp\u003eWe can also refer to the old instance of the record using \u003ccode\u003eOLD\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eBut just like that we’re able to see what changes have been made for a particular post, but inspecting our \u003ccode\u003epost_audits\u003c/code\u003e table. Neat, right?\u003c/p\u003e\n\u003ch2 id=\"viewing-triggers\"\u003eViewing triggers\u003c/h2\u003e\n\u003cp\u003eWe can see all of our triggers with:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSHOW TRIGGERS;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will show us all sorts of useful info like the trigger’s name, the event which will cause it to fire, the table the trigger is set to watch, the actual trigger code, whether it’s a before/after trigger and more.\u003c/p\u003e\n\u003cp\u003eIn some cases, you might have quite a few triggers, so don’t forget that you can slap a \u003ccode\u003eLIKE\u003c/code\u003e on the end of that bad boy and filter the results.\u003c/p\u003e\n\u003ch2 id=\"dropping-triggers\"\u003eDropping triggers\u003c/h2\u003e\n\u003cp\u003eDropping triggers is similar to dropping stored procedures.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDROP TRIGGER payments_after_insert;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd that’s it! I hope this post audits example was a useful proof of concept for what can be down with triggers. I really liked it and might consider using it the next time I need to audit key data.\u003c/p\u003e\n"},{"slug":"sql-functions","frontmatter":{"id":6,"title":"SQL Functions","date":"May 15 2020"},"content":"\u003cp\u003eFunctions in SQL are very similar to stored procedures, but they are still different.\u003c/p\u003e\n\u003cp\u003eHere’s a list of some basic differences between the two:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eA function must return a value, but a stored procedure doesn’t have to. Stored procedures can return 0, or more, values/result sets.\u003c/li\u003e\n\u003cli\u003eFunctions can be called from procedures, but procedures cannot be called from functions.\u003c/li\u003e\n\u003cli\u003eStored procedures cannot be called in SQL statements using \u003ccode\u003eSELECT\u003c/code\u003e/\u003ccode\u003eWHERE\u003c/code\u003e/\u003ccode\u003eHAVING\u003c/code\u003e, but functions can be.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThis isn’t a complete list, and I’m not sure that I’d bore you with those facts, but these are some of the cool ones I found. There’s definitely more!\u003c/p\u003e\n\u003cp\u003eThe syntax for creating functions is very similar to the syntax used to create stored procedures.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDELIMITER $$\n\nCREATE FUNCTION get_average_amount_due(customer_id INT)\nRETURNS DECIMAL(9,2)\nREADS SQL DATA\nBEGIN\n  DECLARE average_amount_due DECIMAL(9, 2) DEFAULT 0;\n  DECLARE total_amount_due DECIMAL(9,2);\n  DECLARE total_invoices INT;\n\n  SELECT SUM(i.amount_due), COUNT(*)\n  INTO total_amount_due, total_invoices\n  FROM invoices i\n  WHERE i.customer_id = customer_id;\n\n  SET average_amount_due = total_amount_due / invoices_count;\n  RETURN IFNULL(average_amount_due, 0);\nEND$$\n\nDELIMITER ;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOk! That’s it. Done. Next post!\u003c/p\u003e\n\u003cp\u003eNah, let’s break this down since there’s a lot going on. Be sure to read post #5 – SQL Stored Procedures to catch up on any explanations I leave out.\u003c/p\u003e\n\u003cp\u003eSo, we start by stating that we’re creating a function. It’s much like the definition for creating a stored procedure, except we also define what this function returns, and in this case its \u003ccode\u003eDECIMAL(9,2)\u003c/code\u003e. This is required when we define a function.\u003c/p\u003e\n\u003cp\u003eNext we define some attributes for this function. Here we’ve stated that this function reads sql data. There’s not many attributes so I’ll quickly cover them:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003eDETERMINISTIC\u003c/code\u003e – Given the same values, this function returns the same result. For example, imagine providing values which result in the cost of shipping on an order.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eREADS SQL DATA\u003c/code\u003e – This function reads data from the database.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eMODIFIES SQL DATA\u003c/code\u003e – This function uses \u003ccode\u003eUPDATE\u003c/code\u003e, \u003ccode\u003eINSERT\u003c/code\u003e or \u003ccode\u003eDELETE\u003c/code\u003e statements.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eWe can mix and match any of these, for example a function can use \u003ccode\u003eREADS SQL DATA\u003c/code\u003e and \u003ccode\u003eMODIFIES SQL DATA\u003c/code\u003e. To do so, just add the next attribute after the other. So that’s attributes done and dusted\u003c/p\u003e\n\u003cp\u003eInside our function body we define some variables and their types using \u003ccode\u003eDECLARE\u003c/code\u003e. Our statement then sets \u003ccode\u003etotal_amount_due\u003c/code\u003e and \u003ccode\u003etotal_invoices\u003c/code\u003e in our select statement. After that we then set the value of \u003ccode\u003eaverage_amount_due\u003c/code\u003e to be \u003ccode\u003etotal_amount_due\u003c/code\u003e/ \u003ccode\u003etotal_invoices\u003c/code\u003e. Nothing too complex.\u003c/p\u003e\n\u003cp\u003eFinally, we have to return a value for this function and it has to be a \u003ccode\u003eDECIMAL(9,2)\u003c/code\u003e and luckily it is. We’re doing a slight trick here to make sure that if the value is \u003ccode\u003eNULL\u003c/code\u003e, then we return 0.\u003c/p\u003e\n\u003cp\u003eThat’s it!\u003c/p\u003e\n\u003cp\u003eNow we can call this function inside a SQL statement like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSELECT customer_id, get_average_amount_due(customer_id)\nFROM invoices;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhich would return a table that looks something like this:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003ecustomer_id\u003c/th\u003e\n\u003cth\u003eget_average_amount_due(customer_id)\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e90.21\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eTo end this post, you can also remove a function when you don’t need it anymore and that’s done like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDROP FUNCTION get_average_amount_due;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd boom! It’s gone!\u003c/p\u003e\n"},{"slug":"sql-stored-procedures","frontmatter":{"id":5,"title":"SQL Stored Procedures","date":"May 14 2020"},"content":"\u003cp\u003eSQL allows us to create something called a stored procedure. It’s basically code which has been saved so that we can call it and reuse it when we need it.\u003c/p\u003e\n\u003cp\u003eWe can even add things like parameters to our stored procedures, so it’s super useful when we don’t want to repetitively write and call a common query.\u003c/p\u003e\n\u003cp\u003eLet’s dive into some of the basics of stored procedures.\u003c/p\u003e\n\u003ch2 id=\"creating-a-stored-procedure\"\u003eCreating a stored procedure:\u003c/h2\u003e\n\u003cp\u003eWe create a stored procedure like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDELIMITER $$\n\nCREATE PROCEDURE get_invoices ()\nBEGIN\n  SELECT * FROM invoices;\nEND$$\n\nDELIMITER ;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThere’s a lot going on here so let’s pick it apart.\u003c/p\u003e\n\u003cp\u003eMySQL clients like MySQL workbench use the \u003ccode\u003e;\u003c/code\u003e delimiter to separate and execute statements.\u003c/p\u003e\n\u003cp\u003eA stored procedure consists of multiple statements, but we need to define our stored procedure in a single statement so that SQL reads in the whole procedure definition at once. In order to do this, we need to use the \u003ccode\u003eDELIMITER\u003c/code\u003e keyword to temporarily redefine the default delimiter. We conventionally use the \u003ccode\u003e$$\u003c/code\u003e delimiter.\nOnce we’ve done this, then our procedure definition is read as one statement, instead multiple separate statements.\u003c/p\u003e\n\u003cp\u003eNext we give the stored procedure a name (\u003ccode\u003eget_invoices\u003c/code\u003e in this case) and we add the required parenthesis. We’ll talk about placing parameters inside the parenthesis later on.\u003c/p\u003e\n\u003cp\u003eEverything between the \u003ccode\u003eBEGIN\u003c/code\u003e and \u003ccode\u003eEND\u003c/code\u003e is called the procedure body and this is where we define our stored procedure.\u003c/p\u003e\n\u003cp\u003eOnce we’ve defined the procedure body we’ll close it with \u003ccode\u003eEND\u003c/code\u003e and our new delimiter on the end to finish up our statement.\u003c/p\u003e\n\u003cp\u003eDon’t forget to set the default delimiter back to \u003ccode\u003e;\u003c/code\u003e!\u003c/p\u003e\n\u003ch2 id=\"calling-a-stored-procedure\"\u003eCalling a stored procedure:\u003c/h2\u003e\n\u003cp\u003eWe can call/execute a stored procedure like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eCALL get_invoices();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou might also see the same thing like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eEXEC get_invoices();\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"adding-parameters-to-stored-procedures\"\u003eAdding parameters to stored procedures:\u003c/h2\u003e\n\u003cp\u003eWe can add parameters to our stored procedures by giving the parameter a name and a type between the procedure’s parenthesis:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDELIMITER $$\n\nCREATE PROCEDURE get_invoices(amount_due DECIMAL(9, 2))\nBEGIN\n  SELECT * FROM invoices i\n  WHERE c.amount_due \u0026lt;= amount_due;\nEND$$\n\nDELIMITER ;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can then call our store procedure like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eCALL get_invoices(1000);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"some-stored-procedure-fun\"\u003eSome stored procedure fun:\u003c/h2\u003e\n\u003cp\u003eWe can do a bunch of cool things in stored procedures like default conditions when parameters are null.\u003c/p\u003e\n\u003cp\u003eHere we return all invoices when our parameter is \u003ccode\u003eNULL\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDELIMITER $$\n\nCREATE PROCEDURE get_invoices(amount_due DECIMAL(9, 2))\nBEGIN\n  SELECT * FROM invoices i\n  WHERE i.amount_due = IFNULL(amount_due, i.amount_due);\nEND$$\n\nDELIMITER ;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd then call it like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eCALL get_invoices(NULL);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"validating-parameters\"\u003eValidating parameters\u003c/h2\u003e\n\u003cp\u003eWe can validate our parameters and use a signal statement to throw an error with the appropriate code which will describe what type of error occurred.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDELIMITER $$\n\nCREATE PROCEDURE update_invoice(invoice_id INT, amount_due decimal(9, 2))\nBEGIN\n  IF amount_due \u0026lt; 0 THEN\n   SIGNAL SQLSTATE ‘22003’\n      SET MESSAGE_TEXT = ‘Invalid amount_due;\n  END IF;\n\n  UPDATE invoices i\n  SET\n     i.amount_due = amount_due\n  WHERE i.invoice_id = invoice_id;\nEND$$\n\nDELIMITER ;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThere’s like a million different kinds of error codes. \u003ca href=\"https://www.ibm.com/support/knowledgecenter/en/SSEPEK_11.0.0/codes/src/tpc/db2z_sqlstatevalues.html\"\u003eCheck them out here\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"deletingdropping-stored-procedures\"\u003eDeleting/dropping stored procedures:\u003c/h2\u003e\n\u003cp\u003eFor the last part of our stored procedure crash course let\u0026#39;s delete/drop a stored procedure:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDROP PROCEDURE get_invoices;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt’s that simple!\u003c/p\u003e\n"},{"slug":"deriving-tables-from-sub-queries","frontmatter":{"id":3,"title":"Deriving Tables From Sub-Queries","date":"May 10 2020"},"content":"\u003cp\u003eHere’s a quick lesson I learnt about. Hopefully it comes in handy some time.\u003c/p\u003e\n\u003cp\u003eI’ve been learning a little about SQL sub-queries lately and I recently discovered that you can query a sub-query. I hope this makes sense, but I’m sure an actual example might make more sense.\u003c/p\u003e\n\u003cp\u003eLet’s say we have a table of customers like this:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003efirst_name\u003c/th\u003e\n\u003cth\u003elast_name\u003c/th\u003e\n\u003cth\u003epoints\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003eAndy\u003c/td\u003e\n\u003ctd\u003eWarhol\u003c/td\u003e\n\u003ctd\u003e1000\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eBobby\u003c/td\u003e\n\u003ctd\u003eBrown\u003c/td\u003e\n\u003ctd\u003e234\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eCandace\u003c/td\u003e\n\u003ctd\u003eLady-face\u003c/td\u003e\n\u003ctd\u003e687\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eLet’s say we made a query like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSELECT first_name, points\nFROM customers;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd then we decided (for some strange reason) that we wanted to make another query on this result where we want to find our customers with 1000 points or more. We can do this like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSELECT first_name\nFROM (\nSELECT first_name, points\nFROM customers\n) AS gold_customers\nWHERE points \u0026gt;= 1000;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow, at first this might not seem super powerful, but it could save us some effort. For example, imagine instead that we wanted to query the result of joining 2 tables together.\u003c/p\u003e\n\u003cp\u003eWe could derive a new table by joining those 2 tables and then we could query that new derived table in the same way we normally query any other table.\u003c/p\u003e\n"},{"slug":"sql-views","frontmatter":{"id":4,"title":"SQL Views","date":"May 10 2020"},"content":"\u003cp\u003eThe more I learn about SQL the more I realize that there’s a million different ways to query the same data, but sometimes you actually just want to use the same query over and over again to get some useful information.\u003c/p\u003e\n\u003cp\u003eSQL views are the perfect way to ensure that you aren’t copying and pasting the same verbose SQL statement over and over again just to query data from your database.\u003c/p\u003e\n\u003cp\u003eA view is essentially a SQL statement which has been saved to create a type of in memory database. It’s super handy since it can take a complicated query and break it down so that you have time to focus on what matters most. There are so caveats though, no solution is perfect. Let’s dive in and learn about SQL views!\u003c/p\u003e\n\u003ch2 id=\"creating-a-sql-view\"\u003eCreating a SQL View\u003c/h2\u003e\n\u003cp\u003eLet’s imagine we have a table called \u003ccode\u003esuppliers\u003c/code\u003e which tracks various information about the suppliers a business uses to get resources to perform various projects.\u003c/p\u003e\n\u003cp\u003eIf, for example, our business found that we kept performing the same sort of query where we want to find all suppliers where the amount of money spent on that supplier exceeded some threshold, then we could save ourselves some time by creating a SQL view like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eCREATE VIEW useful_suppliers AS\nSELECT name, address, amount_spent\nFROM suppliers\nWHERE 1000 \u0026lt; amount_spent;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow, instead of having to write the same select query a million times, we have it saved in our SQL db as a view which we can query like a table.\u003c/p\u003e\n\u003ch2 id=\"querying-data-from-a-sql-view\"\u003eQuerying data from a SQL View\u003c/h2\u003e\n\u003cp\u003eWe can query a view much like any other SQL table.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSELECT SUM(amount_spent) AS total_spent\nFROM useful_suppliers;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eInserting/updating data into a view is a little trickier since there are certain conditions which dictate when this is possible.\u003c/p\u003e\n\u003cp\u003eFor example, it’s possible to update our view based on the following rules:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eOur query does not use the DISTINCT keyword.\u003c/li\u003e\n\u003cli\u003eOur query does not use any summary function or set functions/operators.\u003c/li\u003e\n\u003cli\u003eOur query does not use the ORDER BY clause.\u003c/li\u003e\n\u003cli\u003eOur query does not join multiple tables.\u003c/li\u003e\n\u003cli\u003eOur query does not use a WHERE clause containing subqueries.\u003c/li\u003e\n\u003cli\u003eOur query does not use the GROUP BY or HAVING clauses.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eProvided we follow these rules, we can insert/update our view like anything else in SQL:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eINSERT INTO useful_suppliers (name, address, amount_spent)\nVALUES (‘Tools R Us’, ‘123 Sesame Road’, 1200);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd likewise delete anything:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDELETE FROM useful_suppliers\nWHERE name = ‘Tools R Us’;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis does not mean that we cannot create a view which breaks these rules, but it just means that if we do break these rules, then we can no longer update the values directly using our view.\u003c/p\u003e\n\u003ch2 id=\"changingreplacing-a-sql-view\"\u003eChanging/replacing a SQL View\u003c/h2\u003e\n\u003cp\u003eWe can also change a view we’ve created if our requirements ever change.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eREPLACE VIEW useful_suppliers\nSELECT name, amount_spent\nFROM suppliers\nWHERE 9999 \u0026lt; amount_spent;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"deleting-a-sql-view\"\u003eDeleting a SQL view\u003c/h2\u003e\n\u003cp\u003eWe can also get rid of views which we don’t need. It’s much like dropping any normal table in SQL.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eDROP VIEW useful_customers;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI hope this crash course on views has been insightful. I’ve had the unfortunate opportunity to have to come back to a database every few months, or so, just to perform the same painful and difficult-to-remember query.\u003c/p\u003e\n\u003cp\u003eSo, I was relieved to hear that such a thing existed in SQL. Next time you find yourself with the same issue, try to save yourself the pain and consider using a view!\u003c/p\u003e\n"},{"slug":"sql-cross-join","frontmatter":{"id":2,"title":"SQL Cross Join","date":"May 8 2020"},"content":"\u003cp\u003eLet’s say we’re working in a database for a yet-to-be world-famous shoe company, named Shoe-pple. Shoe-pple is a bit of a peculiar company. Shoe-pple’s unique spin on shoes involves selling one type of shoe in almost any shade of colour possible.\u003c/p\u003e\n\u003cp\u003eOur co-founder, Carl, is finally ready to launch the company’s first line of shoes, but first we need to list every shoe size and colour our manufacturer needs to make.\u003c/p\u003e\n\u003cp\u003eWe’ve got our planned shoe sizes stored in a database table named \u003ccode\u003esizes\u003c/code\u003e and we also have our first set of colours stored in a database table named \u003ccode\u003eshoe_colours\u003c/code\u003e. We need to extract all of this data and then we need to create a list of every possible combination.\u003c/p\u003e\n\u003cp\u003eSounds tricky, but suddenly we remember that SQL Cross Joins can save the day!\u003c/p\u003e\n\u003cp\u003eWe can query all this information and then mix together all the possible combinations by making use of a SQL Cross Join, so let’s do it!\u003c/p\u003e\n\u003cp\u003eWe’ll assume our table \u003ccode\u003esizes\u003c/code\u003e consists of 3 basic sizes: 6, 7, and 8.\nWe’ll also assume our table \u003ccode\u003eshoe_colours\u003c/code\u003e consists of 3 wonderful colours: lavender, maroon, and azure.\u003c/p\u003e\n\u003cp\u003eLet’s build a cross join to mix every combination like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSELECT sizes.size, shoe_colours.colour\nFROM sizes\nCROSS JOIN shoe_colours;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd BOOM! Our result:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003esize\u003c/th\u003e\n\u003cth\u003ecolour\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003eLavender\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003eMaroon\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003eAzure\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003eLavender\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003eMaroon\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003eAzure\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e8\u003c/td\u003e\n\u003ctd\u003eLavender\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e8\u003c/td\u003e\n\u003ctd\u003eMaroon\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e8\u003c/td\u003e\n\u003ctd\u003eAzure\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003ePretty simple, right? Our example might be a little contrived. Our example is simple to do by hand, but given a larger list things could get a little more complicated.\u003c/p\u003e\n\u003cp\u003eYou can also create a cross join by doing something like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSELECT sizes.size, shoe_colours.colour\nFROM sizes, shoe_colours;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSo just a friendly heads up in case you ever see that in the wild.\u003c/p\u003e\n\u003cp\u003eNow that Shoe-pple has our list, it’s time to begin its world shoe domination!\u003c/p\u003e\n"},{"slug":"sql-self-join","frontmatter":{"id":1,"title":"SQL Self Join","date":"May 4 2020"},"content":"\u003cp\u003eI recently learnt that SQL has the ability to join a table to itself, this is called a self-join. This is possible when you have a table which has a column referencing the primary key.\u003c/p\u003e\n\u003cp\u003eLet’s say for example we have an employees table which looks something like this:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eemployee_id\u003c/th\u003e\n\u003cth\u003efirst_name\u003c/th\u003e\n\u003cth\u003elast_name\u003c/th\u003e\n\u003cth\u003emanager_id\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003eAbraham\u003c/td\u003e\n\u003ctd\u003eLincoln\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003eBenjamin\u003c/td\u003e\n\u003ctd\u003eFranklin\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003eCharlie\u003c/td\u003e\n\u003ctd\u003eBrown\u003c/td\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003eDouglas\u003c/td\u003e\n\u003ctd\u003eGreyling\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eSo, for this example, \u003ccode\u003eemployee_id\u003c/code\u003e is our primary key for all of our employees. The employees table has another column, \u003ccode\u003emanager_id\u003c/code\u003e, which tracks whether, or not, this employee has a manager. No manager id could mean that this employee is the head honcho in charge, or that they are a manager who reports to another manager. Makes sense?\u003c/p\u003e\n\u003cp\u003eEither way, we can do a self-join on this table to find all employees who have managers.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSELECT e.first_name, e.last_name, m.first_name AS manager\nFROM employees e\nJOIN employees m\nON e.manager_id = m.employee_id;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOr to be more succinct:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eSELECT e.first_name, e.last_name, m.first_name AS manager\nFROM employees e, employees m\nWHERE e.manager_id = m.employee_id;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOur result should look something like this:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003efirst_name\u003c/th\u003e\n\u003cth\u003elast_name\u003c/th\u003e\n\u003cth\u003emanager\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003eBenjamin\u003c/td\u003e\n\u003ctd\u003eFranklin\u003c/td\u003e\n\u003ctd\u003eAbraham\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eCharlie\u003c/td\u003e\n\u003ctd\u003eBrown\u003c/td\u003e\n\u003ctd\u003eAbraham\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eDouglas\u003c/td\u003e\n\u003ctd\u003eGreyling\u003c/td\u003e\n\u003ctd\u003eBenjamin\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cp\u003eAnd that’s it. I knew about the concept of joins, but I didn’t realise that one could do a self-join. I thought this was pretty awesome!\u003c/p\u003e\n"}]},"__N_SSG":true},"page":"/posts","query":{},"buildId":"BrnbQXyTJJ40OBczySqjf","assetPrefix":"/blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>